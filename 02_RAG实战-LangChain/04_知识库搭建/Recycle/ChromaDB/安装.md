> https://docs.trychroma.com/docs/overview/introduction



# 开始

Chroma 是一个 AI 原生开源向量数据库。它内置了入门所需的一切，并在您的计算机上运行。

## 安装

```
pip install chromadb
```

## 创建 Chroma 客户端

```
import chromadb
chroma_client = chromadb.Client()
```

## 创建集合

集合是您存储嵌入、文档和任何其他元数据的地方。集合为您的嵌入和文档编制索引，并实现高效的检索和筛选。您可以创建具有名称的集合：

```
collection = chroma_client.create_collection(name="my_collection")
```

## 向集合中添加一些文本文档

Chroma 将存储您的文本并自动处理嵌入和索引。您还可以自定义嵌入模型。您必须为文档提供唯一的字符串 ID。

```
collection.add(
    documents=[
        "This is a document about pineapple",
        "This is a document about oranges"
    ],
    ids=["id1", "id2"]
)
```

## 查询集合

您可以使用查询文本列表查询集合，Chroma 将返回n最相似的结果。就是这么简单！

```
results = collection.query(
    query_texts=["This is a query document about hawaii"], # Chroma will embed this for you
    n_results=2 # how many results to return
)
print(results)
```

如果n_results，则 Chroma 默认会返回 10 个结果。这里我们只添加了 2 个文档，所以我们设置n_results=2.

## 检查结果

从上面的查询中 - 你可以看到我们关于夏威夷在语义上与菠萝.

```
{
  'documents': [[
      'This is a document about pineapple',
      'This is a document about oranges'
  ]],
  'ids': [['id1', 'id2']],
  'distances': [[1.0404009819030762, 1.243080496788025]],
  'uris': None,
  'data': None,
  'metadatas': [[None, None]],
  'embeddings': None,
}
```

## 自己尝试一下

例如，如果我们尝试使用“这是一份关于佛罗里达州的文件”?

```
import chromadb
chroma_client = chromadb.Client()

# switch `create_collection` to `get_or_create_collection` to avoid creating a new collection every time
collection = chroma_client.get_or_create_collection(name="my_collection")

# switch `add` to `upsert` to avoid adding the same documents every time
collection.upsert(
    documents=[
        "This is a document about pineapple",
        "This is a document about oranges"
    ],
    ids=["id1", "id2"]
)

results = collection.query(
    query_texts=["This is a query document about florida"], # Chroma will embed this for you
    n_results=2 # how many results to return
)

print(results)
```



# 客户端

## 持久客户端



您可以将 Chroma 配置为从本地计算机保存和加载数据库，使用持久客户端.

数据将自动持久化并在启动时加载（如果存在）。

蟒



```
import chromadb

client = chromadb.PersistentClient(path="/path/to/save/to")
```

这路径是 Chroma 将其数据库文件存储在磁盘上并在启动时加载它们的位置。如果您未提供路径，则默认值为。色度

client 对象有一些有用的便捷方法。

- 心跳（）- 返回纳秒检测信号。用于确保客户端保持连接。
- 重置（）- 清空并完全重置数据库。⚠️ 这是破坏性的，不可逆的。





```
client.heartbeat()
client.reset()
```

## 在客户端-服务器模式下运行 Chroma

Chroma 也可以配置为在客户端/服务器模式下运行。在此模式下，Chroma 客户端连接到在单独进程中运行的 Chroma 服务器。

要启动 Chroma 服务器，请运行以下命令：

终端

```
chroma run --path /db_path
```

```
(langchain) E:\learn-llm-rag-easily\01_Case1RAGviaLangChain\05搭建知识库>chroma run --path chroma4


                (((((((((    (((((####
             ((((((((((((((((((((((#########
           ((((((((((((((((((((((((###########
         ((((((((((((((((((((((((((############
        (((((((((((((((((((((((((((#############
        (((((((((((((((((((((((((((#############
         (((((((((((((((((((((((((##############
         ((((((((((((((((((((((((##############
           (((((((((((((((((((((#############
             ((((((((((((((((##############
                (((((((((    #########



Running Chroma

Saving data to: chroma4
Connect to chroma at: http://localhost:8000
Getting started guide: https://docs.trychroma.com/getting-started


WARNING:  [02-04-2025 18:44:54] chroma_server_nofile is not supported on Windows. chroma_server_nofile will not be set.
INFO:     [02-04-2025 18:44:55] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
DEBUG:    [02-04-2025 18:44:55] Starting component System
DEBUG:    [02-04-2025 18:44:55] Starting component OpenTelemetryClient
DEBUG:    [02-04-2025 18:44:55] Starting component SqliteDB
DEBUG:    [02-04-2025 18:44:55] Starting component SimpleQuotaEnforcer
DEBUG:    [02-04-2025 18:44:55] Starting component Posthog
DEBUG:    [02-04-2025 18:44:55] Starting component SimpleRateLimitEnforcer
DEBUG:    [02-04-2025 18:44:55] Starting component LocalSegmentManager
DEBUG:    [02-04-2025 18:44:55] Starting component LocalExecutor
DEBUG:    [02-04-2025 18:44:55] Starting component SegmentAPI
DEBUG:    [02-04-2025 18:44:55] Starting component SimpleAsyncRateLimitEnforcer
INFO:     [02-04-2025 18:44:56] Started server process [17140]
INFO:     [02-04-2025 18:44:56] Waiting for application startup.
INFO:     [02-04-2025 18:44:56] Application startup complete.
INFO:     [02-04-2025 18:44:56] Uvicorn running on http://localhost:8000 (Press CTRL+C to quit)
```



然后使用 Chroma HTTP 客户端连接服务器：

```
import chromadb

chroma_client = chromadb.HttpClient(host='localhost', port=8000)
```



```
import chromadb
import chromadb.utils.embedding_functions as embedding_functions

chroma_client = chromadb.HttpClient(host='localhost', port=8000)

openai_ef = embedding_functions.OpenAIEmbeddingFunction(
                api_key="5713143e8fdc4b4a8b284cf97092e70f.qEK71mGIlavzO1Io",
                model_name="embedding-2"
            )
collection = chroma_client.get_or_create_collection(
    name="test4",
    embedding_function=openai_ef,  # 使用openai
    metadata={
        "hnsw:space": "cosine", 
        "hnsw:construction_ef": 150,
        "hnsw:M": 24,
        "hnsw:num_threads": 8
    }
)
ids_list = [f"doc_{i+1}" for i in range(len(split_docs[:20]))]
print(ids_list)

try:
    # 添加文档到集合
    collection.add(documents=split_docs[:20], ids =ids_list )
    # 持久化向量数据库
    vectordb.persist()
    print("向量数据库已成功持久化到磁盘。")
except Exception as e:
    print(f"持久化过程中发生错误: {e}")
```





就是这样！Chroma 的 API 将在客户端-服务器模式中仅进行此更改。

Chroma 还提供了一个异步 HTTP 客户端。行为和方法签名与同步客户端相同，但所有会阻止的方法现在都是异步的。要使用它，请调用异步HttpClient相反：

```
import asyncio
import chromadb

async def main():
    client = await chromadb.AsyncHttpClient()

    collection = await client.create_collection(name="my_collection")
    await collection.add(
        documents=["hello world"],
        ids=["id1"]
    )

asyncio.run(main())
```

如果您[部署](https://docs.trychroma.com/production/deployment)了 Chroma 服务器，您也可以使用我们的 [http-only](https://docs.trychroma.com/docs/run-chroma/python-http-client) 软件包。